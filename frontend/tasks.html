<!DOCTYPE html>
<html>
<head>
  <title>To-Do List Manager</title>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
    }
    #logoutBtn {
      background: red;
      color: white;
      border: none;
      padding: 8px 15px;
      cursor: pointer;
      border-radius: 5px;
      margin-bottom: 20px;
    }

    
    label {
      font-weight: bold;
      display: block;
      margin-top: 15px;
    }
    input {
      width: 280px;
      padding: 7px;
      margin-top: 6px;    
      margin-bottom: 12px;
      border: 1px solid #aaa;
      border-radius: 4px;
    }

   
    #addBtn {
      background: green;
      color: white;
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 16px;
      margin-top: 15px;
    }

    #addBtn:hover {
      background: #0c7a0c;
    }

   
    .task-card {
      border: 1px solid #ccc;
      padding: 12px;
      margin-top: 12px;
      border-radius: 5px;
      display: flex;
      justify-content: space-between;
    }

    
    .completed {
      text-decoration: line-through;
      color: green;
    }

   
    button {
      padding: 6px 10px;
      margin-left: 6px;
      cursor: pointer;
      border-radius: 4px;
      border: none;
    }

    .complete-btn { background: #007bff; color: white; }
    .edit-btn { background: orange; color: white; }
    .delete-btn { background: red; color: white; }

  </style>
</head>

<body>

<h2>To-Do List Manager</h2>

<button id="logoutBtn" onclick="logout()">Logout</button>

<label>Task Title</label>
<input id="taskName">

<label>Description</label>
<input id="taskDesc">

<label>Date</label>
<input id="taskDate" type="date">

<label>Time</label>
<input id="taskTime" type="time">

<button id="addBtn" onclick="addTask()">Add Task</button>

<h2>Tasks</h2>
<div id="taskList"></div>

<script>

const API = "http://localhost:3000";


if (!localStorage.getItem("loggedIn")) {
    window.location.href = "index.html";
}


function logout() {
    localStorage.removeItem("loggedIn");
    window.location.href = "index.html";
}


async function loadTasks() {
    const res = await fetch(API + "/tasks");
    const tasks = await res.json();
    document.getElementById("taskList").innerHTML = "";

    tasks.forEach(task => {
        const div = document.createElement("div");
        div.className = "task-card";

        div.innerHTML = `
          <div class="${task.completed ? 'completed' : ''}">
            <b>${task.name}</b><br>
            ${task.description}<br>
            ${task.time}
          </div>

          <div>
            <button class="complete-btn" onclick="completeTask('${task.id}')">Complete</button>
            <button class="edit-btn" onclick="editTask('${task.id}')">Edit</button>
            <button class="delete-btn" onclick="deleteTask('${task.id}')">Delete</button>
          </div>
        `;

        document.getElementById("taskList").appendChild(div);
    });
}


async function addTask() {
    const name = document.getElementById("taskName").value;
    const description = document.getElementById("taskDesc").value;
    const date = document.getElementById("taskDate").value;
    const time = document.getElementById("taskTime").value;

    await fetch(API + "/tasks", {
        method: "POST",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({
            name,
            description,
            time: `${date} • ${time}`,
            completed: false
        })
    });

    loadTasks();
}
 

async function completeTask(id) {
    await fetch(API + "/tasks/" + id, {
        method: "PUT",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ completed: true })
    });

    loadTasks();
}


async function editTask(id) {
    const name = prompt("Enter new task name:");
    const description = prompt("Enter new description:");
    const time = prompt("Enter new date • time:");

    await fetch(API + "/tasks/" + id, {
        method: "PUT",
        headers: {"Content-Type": "application/json"},
        body: JSON.stringify({ name, description, time })
    });

    loadTasks();
}


async function deleteTask(id) {
    await fetch(API + "/tasks/" + id, {
        method: "DELETE"
    });

    loadTasks();
}

loadTasks();

</script>

</body>
</html>
